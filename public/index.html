<html lang="en">
  <title>ðŸ”— âž¡ ðŸ‘Œ</title>
  <meta charset="utf-8">
  <meta name="description" content="Hide your link in a random emoji sequence">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="ðŸ”— âž¡ ðŸ‘Œ">
  <meta name="author" content="Moritz KrÃ¶ger">
  <meta name="theme-color" content="#fff">
  <meta name="og:type" property="og:type" content="website">
  <meta name="og:title" property="og:title" content="ðŸ”— âž¡ ðŸ‘Œ">
  <meta name="og:site_name" property="og:site_name" content="ðŸ”— âž¡ ðŸ‘Œ">
  <meta name="og:description" property="og:description" content="Hide your link in a random emoji sequence">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <style type="text/css">
    :root {
      --base-gap: 20px;
      --base-radius: 6px;
      --border-color: #c3c3c3;
      --border-color-low: #c3c3c366;
      --secondary-background: #f5f5f5;
      --text-color: black;
      --highlight-color: blue;
      --highlight-color-low: #0000ff2b;
    }

    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
    }

    html {
      font-family: Menlo,Consolas,Monaco,"Lucida Console",monospace;
    }

    body {
      font-size: 16px;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: var(--text-color);
    }

    header {
      margin-bottom: var(--base-gap);
    }

    h1, h2, h3 {
      color: var(--highlight-color);
    }

    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 70vw;
    }

    main form {
      text-align: center;
      width: 100%;
      border: 1px solid var(--border-color);
      border-radius: var(--base-radius);
      box-shadow: 4px 4px 0px var(--border-color);
      display: flex;
      justify-content: space-between;
    }
    main form:focus-within {
      border-color: var(--highlight-color);
    }

    main form:focus-within button:hover {
      background: var(--highlight-color-low);
    }

    main form input {
      width: 100%;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }

    main form button {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }

    input {
      padding: var(--base-gap);
      border: none;
      border-radius: var(--base-radius);
      font-size: 150%;
      font-family: inherit;
    }

    input:active,
    input:focus {
      outline: none;
    }

    button {
      padding: var(--base-gap) calc(var(--base-gap) * 1.5);
      font-size: 150%;
      border: none;
      border-radius: var(--base-radius);
      cursor: pointer;
      background: var(--secondary-background);
    }

    button:focus {
      outline: none;
      background: var(--highlight-color-low);
    }

    button:hover {
      background: var(--border-color-low);
    }

    .result {
      margin-top: var(--base-gap);
      display: none;
      flex-direction: column;
      align-items: center;
    }

    .result.show {
      display: flex;
    }

    .result-new {
      font-size: 200%;
    }
  </style>
  <body>
    <header>
      <h1>ðŸ”— âž¡ ðŸ‘Œ</h1>
    </header>

    <main>
      <form action="" method="post" validate>
        <input required type="text" name="url" placeholder="Your URL" />
        <button type="submit">ðŸ”®</button>
      </form>

      <div class="result">
        <code class="result-previous"></code>
        <a class="result-new" rel="noopener" target="_blank"></a>
      </div>
    </main>

    <script defer>
      const $form = document.querySelector('form')
      const $input = $form.elements[0]
      const $result = document.querySelector('.result')
      const $prevURL = $result.querySelector('.result-previous')
      const $newURL = $result.querySelector('.result-new')
      let prevOriginalURL = null
      let newURL = null

      function createNewLink (id) {
        return `${window.location.origin}/${id}`
      }

      function updateResults () {
        $result.classList.add('show')
        $prevURL.textContent = prevOriginalURL
        $newURL.textContent = newURL
        $newURL.setAttribute('href', newURL)
        $input.value = null
        // Change focus
        $form.blur()
        $newURL.focus()
      }

      $form.addEventListener('submit', async event => {
        event.preventDefault()

        try {
          const response = await fetch('/new', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ url: $input.value })
          })
          const json = await response.json()

          prevOriginalURL = json.originalURL
          newURL = createNewLink(json.emojiID)

          updateResults()
        } catch (error) {
          console.error(error)
          prevOriginalURL = null
          newURL = null
        }
      })
    </script>
  </body>
</html>